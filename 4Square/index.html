<html>
	<head>
		<link href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300|Oswald' rel='stylesheet' type='text/css'>
		<script type = "text/javascript">
			
			var SIZE = [4, 4];
			var PLAYERS = 2;
			var MAX = 10;
			var MIN = 1;
			
			var hx = 0;
			var hy = 0;
			
			var cx = "null";
			var cy = "null";
			
			function randint(a, b)
			{
				return Math.floor((Math.random() * b) + a);
			}
			
			function isIn(element, list)
			{
				for(var i = 0; i < list.length; i++)
				{
					if(list[i] == element)
					{
						return true;
					}
				}
				
				return false;
			}
			
			function pushUnique(element, list)
			{
				if(!(isIn(element, list)))
				{	
					list.push(element);
				}
				
				return list;
			}
			
			function Board(size, id)
			{
				this.cells = new Array();
				this.size = size;
				this.id = id;
				
				this.populate = function()
				{
					for(var i = 0; i < this.size[1]; i++) //y dimension
					{
						var temp = new Array(); //create a row
						
						for(var j = 0; j < this.size[0]; j++) //x dimension
						{
							c = new Cell(0, 0, j, i, "normal");
							temp.push(c);
						}
						
						this.cells.push(temp);
					}
				}
				
				this.getCell = function(x, y)
				{
					return this.cells[y][x];
				}
				
				this.getCellNumber = function(x, y)
				{
					return this.getCell(x, y).getNumber();
				}
				
				this.getCellOwner = function(x, y)
				{	
					return this.getCell(x, y).getOwner();
				}
				
				this.setCellNumber = function(x, y, n)
				{	
					(this.cells[y][x]).setNumber(n);
				}
				
				this.setCellOwner = function(x, y, o)
				{
					(this.cells[y][x]).setOwner(o);
				}
				
				this.map = function()
				{
					var output = "";
					
					for(var i = 0; i < this.size[1]; i++) //y dimension
					{
						for(var j = 0; j < this.size[0]; j++) //x dimension
						{
							output += this.getCell(j, i).getNumber().toString() + " ";
						}
						
						output += "\n";
					}
					
					alert(output);
					
					return output;
				}
				
				this.generateHTML = function()
				{
					var output = "";
					
					output += "<table id = \"" + this.id + "\">";
					
					for(var i = 0; i < this.size[1]; i++)
					{
						output += "<tr>";
						
						for(var j = 0; j < this.size[0]; j++)
						{
							output += "<td>" + this.getCell(j, i).generateHTML() + "</td>";
						}
						
						output += "</tr>";
					}
					
					output += "</table>"
				
					return output;
				}
				
				this.render = function(divID)
				{
					var x = document.getElementById(divID);
					x.innerHTML = this.generateHTML();
				}
				
				this.check = function(name)
				{
					var these = new Array();
					
					for(var i = 0; i < this.size[1]; i++)
					{
						for(var j = 0; j < this.size[0]; j++)
						{
							var c = this.getCell(j, i);
							var other = ""; //avoid error?
							var temp = new Array();
							
							if(j + 1 < this.size[0])
							{
								var other = this.getCell(j + 1, i);
								
								if((other.getNumber() < c.getNumber()) && (other.getOwner() != c.getOwner()) && (c.getOwner() == name) && (other.getOwner() != 0))
								{
									these = pushUnique([j + 1, i], these);
								}
							}
							
							if(j - 1 >= 0)
							{
								var other = this.getCell(j - 1, i);
								
								if((other.getNumber() < c.getNumber()) && (other.getOwner() != c.getOwner()) && (c.getOwner() == name) && (other.getOwner() != 0))
								{
									these = pushUnique([j - 1, i], these);
								}
								
							}
							
							if(i + 1 < this.size[1])
							{
								var other = this.getCell(j, i + 1);
								
								if((other.getNumber() < c.getNumber()) && (other.getOwner() != c.getOwner()) && (c.getOwner() == name) && (other.getOwner() != 0))
								{
									these = pushUnique([j, i + 1], these);
								}
							}
							
							if(i - 1 >= 0)
							{
								var other = this.getCell(j, i - 1);
								if((other.getNumber() < c.getNumber()) && (other.getOwner() != c.getOwner()) && (c.getOwner() == name) && (other.getOwner() != 0))
								{
									these = pushUnique([j, i - 1], these);
								}
							}
						}
					}
					
					return these;
				}
				
				this.mapThese = function(th)
				{
					var out = "";
					for(var i = 0; i < th.length; i++)
					{
						out += th[i] + "\n";
					}
					
					alert(out);
				}
			}
			
			function Cell(number, owner, x, y, type)
			{	
				this.number = number;
				this.owner = owner;
				this.x = x;
				this.y = y;
				this.type = type;
				
				this.setNumber = function(n)
				{
					this.number = n;
				}
				
				this.getNumber = function()
				{
					return this.number;
				}
				
				this.getPosition = function()
				{
					return [this.x, this.y];
				}
				
				this.setPosition = function(someX, someY)
				{
					this.x = someX;
					this.y = someY;
				}
				
				this.getType = function()
				{
					return this.type;
				}
				
				this.setType = function(t)
				{
					this.type = t;
				}
				
				this.getOwner = function()
				{
					return this.owner;
				}
				
				this.setOwner = function(o)
				{
					this.owner = o;
				}
				
				this.generateHTML = function()
				{
					return "<div class = \"cell p" + this.owner.toString() + " " + this.type + "\" onmouseover = \"setHoverPosition(" + x.toString() + ", " + y.toString() + ")\" onmouseup = \"setClickedPosition(" + x.toString() + ", " + y.toString() + ")\" >" + this.number.toString() + "</div>";
				}	
			}
			
			function Player(name)
			{	
				this.name = name;
				
				this.getName = function()
				{
					return this.name;
				}
			}
			
			function Players(names)
			{	
				this.names = names;
				this.people = new Array();
				this.current = 1;
				
				this.populate = function()
				{
					for(var i = 0; i < names.length; i++)
					{
						var p = Player(this.names[i]);
						this.people.push(p);
					}
				}
				
				this.getCurrent = function()
				{
					return this.current;
				}
				
				this.getPlayers = function()
				{
					return this.players;
				}
				
				this.next = function()
				{
					this.current = (this.current + 1) % this.people.length;
					if(this.current == 0)
					{
						this.current = 1;
					}
				}
			}
			
			function setHoverPosition(x, y)
			{
				hx = x;
				hy = y;
				
				xIn2.value = x;
				yIn2.value = y;
				v.value = b.getCellNumber(x, y);
			}
			
			function setClickedPosition(x, y)
			{
				cx = x;
				cy = y;
				
				xIn.value = x;
				yIn.value = y;
			}
			
			function makeNames()
			{	
				var output = new Array();
				for(var i = 0; i < PLAYERS; i++)
				{	
					output.push(i);
				}
			}
			
			var b = new Board(SIZE, "board");
			var counter = 0;
			var started = false;
			//var p = Players(makeNames());
			
			function mainLoop()
			{
				if(!started)
				{
					b.populate();
					started = true;
				}
				
				b.render("boardArea");
				
				if(cx != "null")
				{
					b.setCellNumber(cx, cy, randint(MIN, MAX));
					b.setCellOwner(cx, cy, randint(1, PLAYERS));
					b.mapThese(b.check(1));
					cx = "null";
					cy = "null";
				}
			}
			
			var m = setInterval(function(){mainLoop()}, 50);
			
			function stop()
			{
				clearInterval(m);
			}
			
			function setHoverPosition(x, y)
			{
				hx = x;
				hy = y;
				
				xIn2.value = x;
				yIn2.value = y;
				v.value = b.getCellNumber(x, y);
			}
		</script>
		
		<style type = "text/css">
			.cell
			{
				height: 64px;
				width: 64px;
				text-align: center;
				vertical-align: middle;
				font-size: 40px;
				font-weight: bold;
				color: black;
				font-family: 'Oswald', sans-serif;
				text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;
				border: 1px solid white;
				
			}
			
			.p0
			{
				background-color: black;
			}
			
			.p1
			{
				background-color: red;
			}
			
			.p2
			{
				background-color: blue;
			}
			
			.p3
			{
				background-color: orange;
			}
			
			.p4
			{
				background-color: green;
			}
			
			#board
			{
				border: 2px solid black;
				border-spacing: 0;
				margin: 30px 30px 30px 30px;
			}
			
			#board td
			{
				border: 2px solid black;
				padding: 0;
				background-color: black;
			}
			
			#container
			{
				margin: 0 auto;
				width: 345px;
				height: 345px;
				border: 4px solid darkgray;
				background-color: dimgray;
				border-radius: 10%;
			}
			
			body
			{
				background-color: black;
			}
		</style>
	</head>
	
	<body>
		<input type = "button" value = "Stop" onclick = "stop()" />
		<input type = "textarea" value = "" id = "xIn" />
		<input type = "textarea" value = "" id = "yIn" />
		<br><hr>
		<input type = "textarea" value = "" id = "xIn2" />
		<input type = "textarea" value = "" id = "yIn2" />
		<div id = "container">
			<div id = "boardArea"></div>
		</div>
		<input type = "textarea" value = "" id = "v" />
	</body>
</html>